# Извлечение данных

- [Извлечение данных](#извлечение-данных)
  - [Используемая база данных](#используемая-база-данных)
  - [Запросы и операторы](#запросы-и-операторы)
  - [Оператор SELECT](#оператор-select)
  - [Извлечение уникальных записей](#извлечение-уникальных-записей)
  - [Ограничение результатов запроса](#ограничение-результатов-запроса)
  - [Псевдонимы](#псевдонимы)
  - [Примечания](#примечания)
    - [Примечание 1](#примечание-1)
    - [Примечание 2](#примечание-2)
    - [Примечание 3](#примечание-3)
    - [Примечание 4](#примечание-4)

## Используемая база данных

Перед тем как приступить к теме урока, рассмотрим базу данных, которая будет использоваться в последующих примерах. Она состоит из одной таблицы с именем Songs, которая содержит информацию о пяти наиболее популярных песнях на некоторой площадке для прослушивания музыки:

```sql
+----+-------+----------------------+------------+---------+
| id | place | trackname            | artist     | streams |
+----+-------+----------------------+------------+---------+
| 1  | 4     | Crazy On You         | Heart      | 76338   |
| 2  | 3     | My Lover             | The Sounds | 99488   |
| 3  | 2     | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5     | Thrill               | The Sounds | 49345   |
| 5  | 1     | Spent the Day in Bed | Morrissey  | 174994  |
+----+-------+----------------------+------------+---------+
```

Первое поле этой таблицы содержит уникальный идентификатор песни, второе — позицию песни в топе, третье — название песни, четвертое — псевдоним исполнителя или название группы, пятое — количество прослушиваний.

## Запросы и операторы

**SQL-запрос** представляет собой команду, которую мы отправляем базе данных для выполнения определенной задачи, целью которой может являться создание, изменение или извлечение данных. Каждый запрос состоит из **операторов**, определяющих необходимые действия, и различных выражений, например, логических или арифметических.

Операторы также называют **ключевыми словами**. Они представляют собой зарезервированные слова, которые имеют специальное значение и выполняют определенные функции в синтаксисе SQL. Операторы не могут использоваться в качестве имен таблиц, полей или других объектов базы данных.

Например, запрос ниже извлекает из таблицы `Songs` все записи, которые в качестве значения поля streams имеют целочисленное значение, превышающее `100000`:

```sql
SELECT *
FROM Songs
WHERE streams > 100000;
```

Этот запрос состоит из ключевых слов `SELECT`, `FROM` и `WHERE`, а также выражения сравнения с числовым значением. Обратите внимание, что запрос завершается точкой с запятой (`;`), который символизирует конец операции.

## Оператор SELECT

Чтобы при помощи оператора `SELECT` извлечь данные из базы, нужно указать как минимум две вещи: что именно нужно извлечь и откуда. Начнем с простейшего запроса, который извлекает одно определенное поле таблицы.

Результатом приведенного ниже запроса:

```sql
SELECT trackname
FROM Songs;
```

является:

```sql
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```

> Операторы **нечувствительны** к регистру, поэтому, например, записи `SELECT`, `select` и `Select` эквивалентны. Чаще всего разработчики применяют верхний регистр для операторов и нижний регистр для имен полей.

Для извлечения нескольких полей таблицы после оператора `SELECT` необходимо через запятую перечислить их имена.

Результатом приведенного ниже запроса:

```sql
SELECT trackname, artist, streams
FROM Songs;
```

является:

```sql
+----------------------+------------+---------+
| trackname            | artist     | streams |
+----------------------+------------+---------+
| Crazy on You         | Heart      | 76338   |
| My Lover             | The Sounds | 99488   |
| Running up That Hill | Kate Bush  | 121495  |
| Thrill               | The Sounds | 49345   |
| Spent the Day in Bed | Morrissey  | 174994  |
+----------------------+------------+---------+
```

Помимо извлечения конкретных полей, с помощью оператора `SELECT` можно запросить все поля, не указывая каждое из них. Для этого вместо имен полей следует указать специальный групповой символ `*`.

Результатом приведенного ниже запроса:

```sql
SELECT *
FROM Songs;
```

является:

```sql
+----+----------+----------------------+------------+---------+
| id | place    | trackname            | artist     | streams |
+----+----------+----------------------+------------+---------+
| 1  | 4        | Crazy on You         | Heart      | 76338   |
| 2  | 3        | My Lover             | The Sounds | 99488   |
| 3  | 2        | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5        | Thrill               | The Sounds | 49345   |
| 5  | 1        | Spent the Day in Bed | Morrissey  | 174994  |
+----+----------+----------------------+------------+---------+
```

> Несмотря на то что групповой символ помогает сэкономить время, необходимое для перечисления всех нужных полей, используется он не так часто, так как извлечение ненужных полей обычно приводит к **снижению производительности запроса**.

## Извлечение уникальных записей

Чтобы извлечь только уникальные записи, необходимо воспользоваться ключевым словом `DISTINCT`, которое указывается непосредственно перед именами полей.

Результатом приведенного ниже запроса:

```sql
SELECT DISTINCT artist
FROM Songs;
```

является:

```sql
+------------+
| artist     |
+------------+
| Heart      |
| The Sounds |
| Kate Bush  |
| Morrissey  |
+------------+
```

Важно отметить, что ключевое слово `DISTINCT` применяется ко всем полям, а не только к тому, перед которым оно стоит, поэтому при его использовании для двух и более полей одинаковыми будут считаться лишь те записи, которые имеют одинаковые значения по всем полям.

## Ограничение результатов запроса

Иногда при извлечении данных из таблицы может потребоваться получить лишь первую запись или некоторое определенное количество записей. Сделать это можно с помощью ключевого слова `LIMIT`.

Результатом приведенного ниже запроса:

```sql
SELECT trackname
FROM Songs
LIMIT 3;
```

является:

```sql
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
+----------------------+
```

Если необходимо получить следующие три записи, можно задать начальную точку извлечения с помощью ключевого слова `OFFSET`.

Результатом приведенного ниже запроса:

```sql
SELECT trackname
FROM Songs
LIMIT 3
OFFSET 2;
```

является:

```sql
+----------------------+
| trackname            |
+----------------------+
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```

Выражение `LIMIT 3 OFFSET 2` говорит о том, что должно быть извлечено три записи, начиная с записи с индексом два.

> Записи при использовании ключевого слова `OFFSET` индексируются с нуля, поэтому, например, выражение `LIMIT 1 OFFSET 1` вернет вторую запись, а не первую.

> Ключевое слово `OFFSET` можно использовать только в паре с ключевым словом `LIMIT`.

## Псевдонимы

При извлечении различных полей таблицы они сохраняют свои исходные имена в результирующей таблице, однако при необходимости можно воспользоваться **псевдонимами**, чтобы дать им альтернативные имена. Делается это с помощью ключевого слова `AS`, которое располагается между исходным именем поля и новым.

Результатом приведенного ниже запроса:

```sql
SELECT trackname AS 'Song name',
       artist AS Artist
FROM Songs;
```

является:

```sql
+----------------------+------------+
| Song name            | Artist     |
+----------------------+------------+
| Crazy On You         | Heart      |
| My Lover             | The Sounds |
| Running up That Hill | Kate Bush  |
| Thrill               | The Sounds |
| Spent the Day in Bed | Morrissey  |
+----------------------+------------+
```

Обратите внимание: если псевдоним состоит из нескольких слов, он должен быть представлен строкой, заключенной в **апострофы**.

> Псевдонимы могут содержать до 255 знаков, включая пробелы, цифры и специальные символы.

## Примечания

### Примечание 1

Записи в результирующей таблице иногда могут отображаться в произвольном порядке, и это нормально. Например, это может быть порядок, в котором записи заносились в таблицу. Главное, чтобы запрос возвращал одни и те же записи.

### Примечание 2

Все лишние пробельные символы в запросе пропускаются при его обработке, поэтому запрос может быть записан как в одной длинной строке, так и разбит на несколько строк.

Например, приведенные ниже запросы функционально полностью идентичны:

```sql
SELECT trackname
FROM Songs;
```

```sql
SELECT trackname FROM Songs;
```

```sql
SELECT
trackname
FROM
Songs;
```

### Примечание 3

Оператор `SELECT` может использоваться не только для извлечения данных из базы, но и для вывода конкретных значений, например, строк или чисел.

Результатом приведенного ниже запроса:

```sql
SELECT 'beegeek';
```

является:

```sql
+---------+
| beegeek |
+---------+
| beegeek |
+---------+
```

### Примечание 4

Как и многие другие языки, `SQL` поддерживает несколько видов комментариев: **однострочные** и **многострочные**. Однострочные комментарии обозначаются двумя дефисами (`--`):

```sql
-- это комментарий
SELECT trackname    -- это комментарий
FROM Songs;
```

Многострочные комментарии обрамляются сочетанием символов `/*`:

```sql
/*
это
многострочный
комментарий
*/

SELECT trackname
FROM Songs;
```
