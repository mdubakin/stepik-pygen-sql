# Функции даты и времени. Часть 4

- [Функции даты и времени. Часть 4](#функции-даты-и-времени-часть-4)
  - [Форматирование](#форматирование)
  - [Функция DATE\_FORMAT()](#функция-date_format)
  - [Функция TIME\_FORMAT()](#функция-time_format)
  - [Функция STR\_TO\_DATE()](#функция-str_to_date)
  - [Функция GET\_FORMAT()](#функция-get_format)

## Форматирование

По умолчанию вывод даты и времени осуществляется в ISO-формате. Например, дата в таком формате записывается в виде `2023-10-25` (год, месяц, день). Однако для конечного пользователя такой формат может быть не всегда удобен. Российские пользователи, к примеру, привыкли видеть дату в виде `25.10.2023` (день, месяц, год), что заметно отличается от даты в формате ISO.

`SQL` позволяет определить любой необходимый формат отображения даты и времени c помощью строк формата. Например, дата `2023-10-25` при форматировании в соответствии со строкой формата `%d.%m.%Y` будет иметь вид `25.10.2023`. Значения `%d`, `%m` и `%Y` в строке формата называются спецификаторами формата. Каждый из них представляет собой символ, предваренный знаком процента (`%`), который обозначает какую-либо компоненту даты и времени. Например, `%d` обозначает день месяца, а `%m` и `%Y` — номер месяца и год соответственно.

В таблице ниже представлены основные спецификаторы формата:

![](https://i.ibb.co/GkMRR6w/image.png)

> Следует уточнить, что таблица выше включает лишь отобранные нами наиболее полезные спецификаторы формата, однако на самом деле их гораздо больше. С полным списком спецификаторов формата можно ознакомиться по [ссылке](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-format).

## Функция DATE_FORMAT()

Функция `DATE_FORMAT()` используется для форматирования даты и времени. Она принимает два аргумента в следующем порядке:

- `datetime` — дата и время
- `format` — строка формата

Функция преобразует дату и время `datetime` в строку в соответствии с форматом `format` и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT DATE_FORMAT('2023-10-20 07:30:00', '%H:%i, %d.%m.%Y');
```

является:

```sql
+-------------------------------------------------------+
| DATE_FORMAT('2023-10-20 07:30:00', '%H:%i, %d.%m.%Y') |
+-------------------------------------------------------+
| 07:30, 20.10.2023                                     |
+-------------------------------------------------------+
```

Функция `DATE_FORMAT()` в качестве первого аргумента может принимать не только дату и время, но и просто дату. Во втором случае считается, что дата имеет нулевые значения по всем компонентам времени.

Результатом приведенного ниже запроса:

```sql
SELECT DATE_FORMAT('2023-10-20', '%d.%m.%Y'),
       DATE_FORMAT('2023-10-20', '%H:%i, %d.%m.%Y');
```

является:

```sql
+---------------------------------------+----------------------------------------------+
| DATE_FORMAT('2023-10-20', '%d.%m.%Y') | DATE_FORMAT('2023-10-20', '%H:%i, %d.%m.%Y') |
+---------------------------------------+----------------------------------------------+
| 20.10.2023                            | 00:00, 20.10.2023                            |
+---------------------------------------+----------------------------------------------+
```

## Функция TIME_FORMAT()

Функция `TIME_FORMAT()` используется для форматирования времени. Она принимает два аргумента в следующем порядке:

- `time` — временное значение
- `format` — строка формата

Функция преобразует временное значение `time` в строку в соответствии с форматом `format` и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT TIME_FORMAT('12:30:00', '%H::%i::%s'),
       TIME_FORMAT('12:30:00', 'Time: %H:%i');
```

является:

```sql
+---------------------------------------+----------------------------------------+
| TIME_FORMAT('12:30:00', '%H::%i::%s') | TIME_FORMAT('12:30:00', 'Time: %H:%i') |
+---------------------------------------+----------------------------------------+
| 12::30::00                            | Time: 12:30                            |
+---------------------------------------+----------------------------------------+
```

## Функция STR_TO_DATE()

Функция `STR_TO_DATE()` используется для выполнения операции, обратной форматированию. Она принимает два аргумента в следующем порядке:

- `string` — строка с компонентами даты и времени
- `format` — строка формата

Функция извлекает из строки `string` компоненты даты и времени в соответствии с форматом `format` и возвращает дату и время на основе извлеченных компонентов.

Результатом приведенного ниже запроса:

```sql
SELECT STR_TO_DATE('07:30, 20.10.2023', '%H:%i, %d.%m.%Y');
```

является:

```sql
+-----------------------------------------------------+
| STR_TO_DATE('07:30, 20.10.2023', '%H:%i, %d.%m.%Y') |
+-----------------------------------------------------+
| 2023-10-20 07:30:00                                 |
+-----------------------------------------------------+
```

Если в строке с компонентами представлены только компоненты даты, функция `STR_TO_DATE()` вернет дату без времени, если только компоненты времени — время без даты.

Результатом приведенного ниже запроса:

```sql
SELECT STR_TO_DATE('20.10.2023', '%d.%m.%Y'),
       STR_TO_DATE('Time: 07:30', 'Time: %H:%i');
```

является:

```sql
+---------------------------------------+-------------------------------------------+
| STR_TO_DATE('20.10.2023', '%d.%m.%Y') | STR_TO_DATE('Time: 07:30', 'Time: %H:%i') |
+---------------------------------------+-------------------------------------------+
| 2023-10-20                            | 07:30:00                                  |
+---------------------------------------+-------------------------------------------+
```

При этом для создания даты или даты и времени должны быть определены все компоненты даты (год, месяц, число), и если хотя бы один компонент пропущен, функция вернет значение `NULL`. В случае с временным значением достаточно одного любого компонента, остальные по умолчанию примут значение `0`.

Результатом приведенного ниже запроса:

```sql
SELECT STR_TO_DATE('20.10', '%d.%m'),
       STR_TO_DATE('Time: 07', 'Time: %H');
```

является:

```sql
+-------------------------------+-------------------------------------+
| STR_TO_DATE('20.10', '%d.%m') | STR_TO_DATE('Time: 07', 'Time: %H') |
+-------------------------------+-------------------------------------+
| NULL                          | 7:00:00                             |
+-------------------------------+-------------------------------------+
```

Во время использования функции `STR_TO_DATE()` необходимо следить за тем, чтобы строка с компонентами даты и времени полностью соответствовала строке формата, в противном случае функция вернет значение `NULL`.

Результатом приведенного ниже запроса:

```sql
SELECT STR_TO_DATE('20.10.2023', '%d-%m-%Y'),
       STR_TO_DATE('Time: 07:30', '%H:%i');
```

является:

```sql
+---------------------------------------+-------------------------------------+
| STR_TO_DATE('20.10.2023', '%d-%m-%Y') | STR_TO_DATE('Time: 07:30', '%H:%i') |
+---------------------------------------+-------------------------------------+
| NULL                                  | NULL                                |
+---------------------------------------+-------------------------------------+
```

## Функция GET_FORMAT()

Функция `GET_FORMAT()` используется для получения определенной строки формата для даты, времени или даты и времени. Она принимает два аргумента в следующем порядке:

- `type` — тип объекта, для которого требуется строка формата (`DATE`, `TIME` или `DATETIME`)
- `format` — непосредственно формат (`USA`, `JIS`, `ISO` или `EUR`)

Функция возвращает строку формата `format` для объекта типа `type`.

Результатом приведенного ниже запроса:

```sql
SELECT GET_FORMAT(DATE, 'EUR'),
       GET_FORMAT(TIME, 'EUR'),
       GET_FORMAT(DATETIME, 'EUR');
```

является:

```sql
+-------------------------+-------------------------+-----------------------------+
| GET_FORMAT(DATE, 'EUR') | GET_FORMAT(TIME, 'EUR') | GET_FORMAT(DATETIME, 'EUR') |
+-------------------------+-------------------------+-----------------------------+
| %d.%m.%Y                | %H.%i.%s                | %Y-%m-%d %H.%i.%s           |
+-------------------------+-------------------------+-----------------------------+
```

Функцию `GET_FORMAT()` удобно использовать совместно с функциями `DATE_FORMAT()` и `TIME_FORMAT()`.

Результатом приведенного ниже запроса:

```sql
SELECT DATE_FORMAT('2023-10-20', GET_FORMAT(DATE, 'USA')),
       TIME_FORMAT('07:30:00', GET_FORMAT(TIME, 'USA'));
```

является:

```sql
+----------------------------------------------------+--------------------------------------------------+
| DATE_FORMAT('2023-10-20', GET_FORMAT(DATE, 'USA')) | TIME_FORMAT('07:30:00', GET_FORMAT(TIME, 'USA')) |
+----------------------------------------------------+--------------------------------------------------+
| 10.20.2023                                         | 07:30:00 AM                                      |
+----------------------------------------------------+--------------------------------------------------+
```
