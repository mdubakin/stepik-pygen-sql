# Функции даты и времени. Часть 3

- [Функции даты и времени. Часть 3](#функции-даты-и-времени-часть-3)
  - [Функции ADDDATE() и SUBDATE()](#функции-adddate-и-subdate)
  - [Функции ADDTIME() и SUBTIME()](#функции-addtime-и-subtime)
  - [Функция DATEDIFF()](#функция-datediff)
  - [Функция TIMEDIFF()](#функция-timediff)
  - [Функция TIMESTAMPDIFF()](#функция-timestampdiff)
  - [Функция TIMESTAMP()](#функция-timestamp)

## Функции ADDDATE() и SUBDATE()

Функция `ADDDATE()` используется для прибавления временного интервала к дате и времени. Она принимает два аргумента в следующем порядке:

- `datetime` — дата и время
- `interval` — временной интервал

Функция прибавляет временной интервал `interval` к дате и времени `datetime` и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT ADDDATE('2023-10-20 07:30:00', INTERVAL 4 DAY),
       ADDDATE('2023-10-20 07:30:00', INTERVAL 4 HOUR);
```

является:

```sql
+------------------------------------------------+-------------------------------------------------+
| ADDDATE('2023-10-20 07:30:00', INTERVAL 4 DAY) | ADDDATE('2023-10-20 07:30:00', INTERVAL 4 HOUR) |
+------------------------------------------------+-------------------------------------------------+
| 2023-10-24 07:30:00                            | 2023-10-20 11:30:00                             |
+------------------------------------------------+-------------------------------------------------+
```

Похожим образом себя ведет функция `SUBDATE()` за тем исключением, что она вычитает временной интервал из даты и времени, а не прибавляет.

Результатом приведенного ниже запроса:

```sql
SELECT SUBDATE('2023-10-20 07:30:00', INTERVAL 4 DAY),
       SUBDATE('2023-10-20 07:30:00', INTERVAL 4 HOUR);
```

является:

```sql
+------------------------------------------------+-------------------------------------------------+
| SUBDATE('2023-10-20 07:30:00', INTERVAL 4 DAY) | SUBDATE('2023-10-20 07:30:00', INTERVAL 4 HOUR) |
+------------------------------------------------+-------------------------------------------------+
| 2023-10-16 07:30:00                            | 2023-10-20 03:30:00                             |
+------------------------------------------------+-------------------------------------------------+
```

Функции `ADDDATE()` и `SUBDATE()` в качестве первого аргумента могут принимать не только дату и время, но и просто дату.

Результатом приведенного ниже запроса:

```sql
SELECT ADDDATE('2023-10-20', INTERVAL 4 DAY),
       SUBDATE('2023-10-20', INTERVAL 24 HOUR);
```

является:

```sql
+---------------------------------------+-----------------------------------------+
| ADDDATE('2023-10-20', INTERVAL 4 DAY) | SUBDATE('2023-10-20', INTERVAL 24 HOUR) |
+---------------------------------------+-----------------------------------------+
| 2023-10-24                            | 2023-10-19 00:00:00                     |
+---------------------------------------+-----------------------------------------+
```

## Функции ADDTIME() и SUBTIME()

Функция `ADDTIME()` используется для прибавления временного значения к дате и времени. Она принимает два аргумента в следующем порядке:

- `datetime` — дата и время
- `time` — временное значение

Функция прибавляет временное значение `time` к дате и времени `datetime` и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT ADDTIME('2023-10-20 21:00:00', '02:00:00'),
       ADDTIME('2023-10-20 21:00:00', '06:00:00');
```

является:

```sql
+--------------------------------------------+--------------------------------------------+
| ADDTIME('2023-10-20 21:00:00', '02:00:00') | ADDTIME('2023-10-20 21:00:00', '06:00:00') |
+--------------------------------------------+--------------------------------------------+
| 2023-10-20 23:00:00                        | 2023-10-21 03:00:00                        |
+--------------------------------------------+--------------------------------------------+
```

Похожим образом себя ведет функция `SUBTIME()` за тем исключением, что она вычитает временное значение из даты и времени, а не прибавляет.

Результатом приведенного ниже запроса:

```sql
SELECT SUBTIME('2023-10-20 21:00:00', '02:00:00'),
       SUBTIME('2023-10-20 21:00:00', '06:00:00');
```

является:

```sql
+--------------------------------------------+--------------------------------------------+
| SUBTIME('2023-10-20 21:00:00', '02:00:00') | SUBTIME('2023-10-20 21:00:00', '06:00:00') |
+--------------------------------------------+--------------------------------------------+
| 2023-10-20 19:00:00                        | 2023-10-20 15:00:00                        |
+--------------------------------------------+--------------------------------------------+
```

Функции `ADDTIME()` и `SUBTIME()` в качестве первого аргумента могут принимать не только дату и время, но и просто время, поэтому они могут использоваться для выполнения арифметических операций с временными значениями.

Результатом приведенного ниже запроса:

```sql
SELECT ADDTIME('21:30:00', '08:30:00'),
       SUBTIME('20:40:00', '10:00:00');
```

является:

```sql
+---------------------------------+---------------------------------+
| ADDTIME('21:30:00', '08:30:00') | SUBTIME('20:40:00', '10:00:00') |
+---------------------------------+---------------------------------+
| 30:00:00                        | 10:40:00                        |
+---------------------------------+---------------------------------+
```

Если первое временное значение, переданное в функцию `SUBTIME()`, меньше второго, функция вернет отрицательный результат.

Результатом приведенного ниже запроса:

```sql
SELECT SUBTIME('20:00:00', '30:00:00');
```

является:

```sql
+---------------------------------+
| SUBTIME('20:00:00', '30:00:00') |
+---------------------------------+
| -10:00:00                       |
+---------------------------------+
```

## Функция DATEDIFF()

Функция `DATEDIFF()` используется для вычисления разницы в днях между двумя значениями даты и времени. Она принимает два аргумента в следующем порядке:

- `datetime1` — первая дата и время
- `datetime2` — вторая дата и время

Функция возвращает количество дней между значениями даты и времени `datetime1` и `datetime2`.

Результатом приведенного ниже запроса:

```sql
SELECT DATEDIFF('2023-10-20 7:30:00', '2023-10-20 8:00:00'),
       DATEDIFF('2023-10-26 7:30:00', '2023-10-20 8:00:00');
```

является:

```sql
+------------------------------------------------------+------------------------------------------------------+
| DATEDIFF('2023-10-20 7:30:00', '2023-10-20 8:00:00') | DATEDIFF('2023-10-26 7:30:00', '2023-10-20 8:00:00') |
+------------------------------------------------------+------------------------------------------------------+
| 0                                                    | 6                                                    |
+------------------------------------------------------+------------------------------------------------------+
```

Если первая дата и время, переданная в функцию `DATEDIFF()`, меньше второй, функция вернет отрицательный результат.

Результатом приведенного ниже запроса:

```sql
SELECT DATEDIFF('2023-10-20 07:30:00', '2023-10-26 08:00:00');
```

является:

```sql
+--------------------------------------------------------+
| DATEDIFF('2023-10-20 07:30:00', '2023-10-26 08:00:00') |
+--------------------------------------------------------+
| -6                                                     |
+--------------------------------------------------------+
```

> При вычислении разницы функция DATEDIFF() использует только дату, время не используется, поэтому каждый из аргументов, передаваемых в функцию, может быть как датой и временем, так и просто датой.

## Функция TIMEDIFF()

Функция `TIMEDIFF()` используется для вычисления разницы во времени между двумя значениями даты и времени. Она принимает два аргумента в следующем порядке:

- `datetime1` — первая дата и время
- `datetime2` — вторая дата и время

Функция возвращает разницу во времени между значениями даты и времени `datetime1` и `datetime2`.

Результатом приведенного ниже запроса:

```sql
SELECT TIMEDIFF('2023-10-20 9:00:00', '2023-10-20 07:00:00'),
       TIMEDIFF('2023-10-25 9:00:00', '2023-10-20 07:00:00');
```

является:

```sql
+-------------------------------------------------------+-------------------------------------------------------+
| TIMEDIFF('2023-10-20 9:00:00', '2023-10-20 07:00:00') | TIMEDIFF('2023-10-25 9:00:00', '2023-10-20 07:00:00') |
+-------------------------------------------------------+-------------------------------------------------------+
| 02:00:00                                              | 122:00:00                                             |
+-------------------------------------------------------+-------------------------------------------------------+
```

Если первая дата и время, переданная в функцию `TIMEDIFF()`, меньше второй, функция вернет результат в виде отрицательного временного значения.

Результатом приведенного ниже запроса:

```sql
SELECT TIMEDIFF('2023-10-20 7:00:00', '2023-10-20 9:00:00');
```

является:

```sql
+------------------------------------------------------+
| TIMEDIFF('2023-10-20 7:00:00', '2023-10-20 9:00:00') |
+------------------------------------------------------+
| -02:00:00                                            |
+------------------------------------------------------+
```

Функция `TIMEDIFF()` может использоваться не только для вычисления разницы во времени между двумя значениями даты и времени, но и просто между двумя временными значениями.

Результатом приведенного ниже запроса:

```sql
SELECT TIMEDIFF('7:00:00', '15:00:00'),
       TIMEDIFF('16:00:00', '11:00:00');
```

является:

```sql
+---------------------------------+----------------------------------+
| TIMEDIFF('7:00:00', '15:00:00') | TIMEDIFF('16:00:00', '11:00:00') |
+---------------------------------+----------------------------------+
| -08:00:00                       | 05:00:00                         |
+---------------------------------+----------------------------------+
```

## Функция TIMESTAMPDIFF()

Функция `TIMESTAMPDIFF()` используется для вычисления разницы между двумя значениями даты и времени в определенных единицах измерения. Она принимает три аргумента в следующем порядке:

- `unit` — единица измерения, в которой требуется получить разницу
- `datetime1` — первая дата и время
- `datetime2` — вторая дата и время

Функция возвращает разницу между значениями даты и времени datetime1 и datetime2 в единицах измерения unit.

Результатом приведенного ниже запроса:

```sql
SELECT TIMESTAMPDIFF(HOUR, '2023-10-20 07:00:00', '2023-10-20 12:00:00') AS hours,
       TIMESTAMPDIFF(MONTH, '2023-10-20 07:00:00', '2023-12-31 12:00:00') AS months;
```

является:

```sql
+-------+--------+
| hours | months |
+-------+--------+
| 5     | 2      |
+-------+--------+
```

Если первое дата и время, переданное в функцию `TIMESTAMPDIFF()`, больше второго, функция вернет отрицательный результат.

Результатом приведенного ниже запроса:

```sql
SELECT TIMESTAMPDIFF(HOUR, '2023-10-20 12:00:00', '2023-10-20 07:00:00');
```

является:

```sql
+-------------------------------------------------------------------+
| TIMESTAMPDIFF(HOUR, '2023-10-20 12:00:00', '2023-10-20 07:00:00') |
+-------------------------------------------------------------------+
| -5                                                                |
+-------------------------------------------------------------------+
```

Следует заметить, что единица измерения, передаваемая в функцию `TIMESTAMPDIFF()` в качестве первого аргумента, должна быть одиночной, в противном случае произойдет ошибка.

Результатом приведенного ниже запроса:

```sql
SELECT TIMESTAMPDIFF(DAY_HOUR, '2023-10-20 07:00:00', '2023-10-25 12:00:00');
```

является ошибка:

```sql
ERROR 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DAY_HOUR, '2023-10-20 07:00:00', '2023-10-25 12:00:00')' at line 1
```

Каждый из аргументов, передаваемых в функцию `TIMESTAMPDIFF()`, может быть как датой и временем, так и просто датой, при этом дата имеет нулевые значения по всем компонентам времени.

## Функция TIMESTAMP()

Функция `TIMESTAMP()` используется для объединения даты и временного значения. Она принимает два аргумента в следующем порядке:

- `date` — дата
- `time` — временное значение

Функция объединяет дату `date` и время `time` и возвращает полученный результат в виде единого объекта.

Результатом приведенного ниже запроса:

```sql
SELECT TIMESTAMP('2023-10-20', '08:00'),
       TIMESTAMP('2023-10-20', '28:00');
```

является:

```sql
+----------------------------------+----------------------------------+
| TIMESTAMP('2023-10-20', '08:00') | TIMESTAMP('2023-10-20', '28:00') |
+----------------------------------+----------------------------------+
| 2023-10-20 08:00:00              | 2023-10-21 04:00:00              |
+----------------------------------+----------------------------------+
```

Обратите внимание, что функция `TIMESTAMP()` автоматически конвертирует каждые 24 часа в 1 день.

Временное значение может не указываться, в таком случае оно будет принято равным `00:00:00`.

Результатом приведенного ниже запроса:

```sql
SELECT TIMESTAMP('2023-10-20');
```

является:

```sql
+-------------------------+
| TIMESTAMP('2023-10-20') |
+-------------------------+
| 2023-10-20 00:00:00     |
+-------------------------+
```
