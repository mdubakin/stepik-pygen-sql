# Функции даты и времени. Часть 1

- [Функции даты и времени. Часть 1](#функции-даты-и-времени-часть-1)
  - [Временные интервалы](#временные-интервалы)
    - [Поддерживаемые единицы измерения](#поддерживаемые-единицы-измерения)
    - [Примеры использования временных интервалов](#примеры-использования-временных-интервалов)
  - [Функции NOW(), CURDATE() и CURTIME()](#функции-now-curdate-и-curtime)
  - [Функции UTC\_TIMESTAMP(), UTC\_DATE() и UTC\_TIME()](#функции-utc_timestamp-utc_date-и-utc_time)
  - [Функция MAKEDATE()](#функция-makedate)
  - [Функция MAKETIME()](#функция-maketime)
  - [Функция TIME\_TO\_SEC() и SEC\_TO\_TIME()](#функция-time_to_sec-и-sec_to_time)
  - [Функции TO\_DAYS() и TO\_SECONDS()](#функции-to_days-и-to_seconds)
  - [Функция LAST\_DAY()](#функция-last_day)

## Временные интервалы

В SQL для работы с датой и временем часто используются временные интервалы. Они представляют собой некоторый промежуток времени, выраженный в тех или иных единицах измерения (день, год, минута), и используются для выполнения арифметических операций с датой и временем.

Для записи временных интервалов применяется следующий синтаксис:

```sql
INTERVAL <величина интервала> <единица измерения>
```

Единица измерения во временном интервале определяется ключевым словом. Например, день — это `DAY`, год — это `YEAR`, год и месяц — это `YEAR_MONTH`. Формат величины интервала напрямую зависит от единицы измерения. Для одиночных единиц измерения, таких как день или год, форматом величины является целое число.

К примеру, интервал в 1 год определяется следующим образом:

```sql
INTERVAL 1 YEAR
```

Для составных единиц измерения, таких как год и месяц, форматом величины является строка определенного вида, в которой перечислены все необходимые значения компонентов.

К примеру, интервал в 10 лет и 2 месяца определяется следующим образом:

```sql
INTERVAL '10-2' YEAR_MONTH
```

### Поддерживаемые единицы измерения

SQL поддерживает большое количество единиц измерения. Для удобства мы разбили их на две таблицы, в одной из которых представлены одиночные единицы измерения, в другой — составные.

Итак, первая таблица включает все поддерживаемые одиночные единицы измерения:
![](https://i.ibb.co/HNhrjqY/image.png)

Вторая таблица включает все поддерживаемые составные единицы измерения, а также формат величины для каждой из единиц:
![](https://i.ibb.co/B6C9D3s/image.png)

### Примеры использования временных интервалов

Для большей наглядности рассмотрим несколько примеров использования временных интервалов.

**Пример 1**. Прибавим к дате 2023-01-01 интервал в 10 лет и 2 месяца.

Результатом приведенного ниже запроса:

```sql
SELECT '2023-01-01' + INTERVAL '10-2' YEAR_MONTH;
```

является:

```sql
+-------------------------------------------+
| '2023-01-01' + INTERVAL '10-2' YEAR_MONTH |
+-------------------------------------------+
| 2033-03-01                                |
+-------------------------------------------+
```

**Пример 2**. Вычтем из даты и времени 2023-01-01 14:00:00 интервал в 1 час и 30 минут.

Результатом приведенного ниже запроса:

```sql
SELECT '2023-01-01 14:00:00' - INTERVAL '01:30' HOUR_MINUTE;
```

является:

```sql
+------------------------------------------------------+
| '2023-01-01 14:00:00' - INTERVAL '01:30' HOUR_MINUTE |
+------------------------------------------------------+
| 2023-01-01 12:30:00                                  |
+------------------------------------------------------+
```

Пример 3. Прибавим к дате и времени 2023-01-01 14:00:00 интервал в 4 дня и 2 часа.

Результатом приведенного ниже запроса:

```sql
SELECT '2023-01-01 14:00:00' + INTERVAL '4 2' DAY_HOUR;
```

является:

```sql
+-------------------------------------------------+
| '2023-01-01 14:00:00' + INTERVAL '4 2' DAY_HOUR |
+-------------------------------------------------+
| 2023-01-05 16:00:00                             |
+-------------------------------------------------+
```

Пример 4. Вычтем из даты 2023-01-01 интервал в 1 час.

Результатом приведенного ниже запроса:

```sql
SELECT '2023-01-01' - INTERVAL 1 HOUR;
```

является:

```sql
+--------------------------------+
| '2023-01-01' - INTERVAL 1 HOUR |
+--------------------------------+
| 2022-12-31 23:00:00            |
+--------------------------------+
```

Обратите внимание, что из даты без времени допускается вычитать временное значение. Во время выполнения такой операции считается, что дата имеет нулевые значения по всем компонентам времени — 0 часов, 0 минут и 0 секунд. Аналогичное справедливо и при прибавлении временного значения к дате без времени.

## Функции NOW(), CURDATE() и CURTIME()

Функция `NOW()` используется для получения текущей даты и времени. Она не принимает никаких аргументов и возвращает текущую дату и время в локальном часовом поясе, например, в том, который используется в операционной системе.

Результатом приведенного ниже запроса:

```sql
SELECT NOW();
```

может являться:

```sql
+---------------------+
| NOW()               |
+---------------------+
| 2023-06-27 10:14:48 |
+---------------------+
```

Похожим образом себя ведут функции `CURDATE()` и `CURTIME()` за тем исключением, что они возвращают текущую дату и текущее время соответственно.

Результатом приведенного ниже запроса:

```sql
SELECT CURTIME(),
       CURDATE();
```

может являться:

```sql
+-----------+------------+
| CURTIME() | CURDATE()  |
+-----------+------------+
| 10:23:15  | 2023-06-27 |
+-----------+------------+
```

## Функции UTC_TIMESTAMP(), UTC_DATE() и UTC_TIME()

Функция `UTC_TIMESTAMP()` используется для получения текущей даты и времени. Она не принимает никаких аргументов и возвращает текущую дату и время в UTC, то есть в нулевом часовом поясе.

Результатом приведенного ниже запроса:

```sql
SELECT UTC_TIMESTAMP();
```

может являться:

```sql
+---------------------+
| UTC_TIMESTAMP()     |
+---------------------+
| 2023-06-28 05:44:53 |
+---------------------+
```

Похожим образом себя ведут функции `UTC_DATE()` и `UTC_TIME()` за тем исключением, что они возвращают текущую дату и текущее время соответственно.

Результатом приведенного ниже запроса:

```sql
SELECT UTC_DATE(),
       UTC_TIME();
```

может являться:

```sql
+------------+------------+
| UTC_DATE() | UTC_TIME() |
+------------+------------+
| 2023-10-17 | 13:57:34   |
+------------+------------+
```

Во время работы с датой и временем рекомендуется использовать именно функции `UTC_TIMESTAMP()`, `UTC_DATE()` и `UTC_TIME()`, а приведение к определенному часовому поясу при необходимости выполнять вручную.

## Функция MAKEDATE()

Функция `MAKEDATE()` используется для создания даты. Она принимает два аргумента в следующем порядке:

- `year` — год
- `day` — номер дня в году
Функция возвращает дату, которая имеет порядковый номер `day` в году `year`.

Результатом приведенного ниже запроса:

```sql
SELECT MAKEDATE(2023, 1),
       MAKEDATE(2023, 255),
       MAKEDATE(2023, 365);
```

является:

```sql
+-------------------+---------------------+---------------------+
| MAKEDATE(2023, 1) | MAKEDATE(2023, 255) | MAKEDATE(2023, 365) |
+-------------------+---------------------+---------------------+
| 2023-01-01        | 2023-09-12          | 2023-12-31          |
+-------------------+---------------------+---------------------+
```

Если указанный номер дня в году больше количества дней в этом году, функция `MAKEDATE()` преобразует каждые 365-366 дней в полный год.

Результатом приведенного ниже запроса:

```sql
SELECT MAKEDATE(2023, 366),
       MAKEDATE(2023, 732);
```

является:

```sql
+---------------------+---------------------+
| MAKEDATE(2023, 366) | MAKEDATE(2023, 732) |
+---------------------+---------------------+
| 2024-01-01          | 2025-01-01          |
+---------------------+---------------------+
```

## Функция MAKETIME()

Функция `MAKETIME()` используется для создания временного значения. Она принимает три аргумента в следующем порядке:

- `hours` — часы
- `minutes` — минуты
- `seconds` — секунды
Функция возвращает временное значение, состоящее из `hours` часов, `minutes` минут и `seconds` секунд.

Результатом приведенного ниже запроса:

```sql
SELECT MAKETIME(12, 33, 1),
       MAKETIME(0, 1, 2),
       MAKETIME(21, 11, 42);
```

является:

```sql
+---------------------+-------------------+----------------------+
| MAKETIME(12, 33, 1) | MAKETIME(0, 1, 2) | MAKETIME(21, 11, 42) |
+---------------------+-------------------+----------------------+
| 12:33:01            | 00:01:02          | 21:11:42             |
+---------------------+-------------------+----------------------+
```

Функция `MAKETIME()` может обрабатывать значение часов больше, чем есть в сутках, но не может обрабатывать значение минут и секунд больше 59. Если количество минут или секунд больше 59, функция вернет значение `NULL`.

Результатом приведенного ниже запроса:

```sql
SELECT MAKETIME(222, 50, 11),
       MAKETIME(10, 60, 12),
       MAKETIME(5, 33, 79);
```

является:

```sql
+-----------------------+----------------------+---------------------+
| MAKETIME(222, 50, 11) | MAKETIME(10, 60, 12) | MAKETIME(5, 33, 79) |
+-----------------------+----------------------+---------------------+
| 222:50:11             | NULL                 | NULL                |
+-----------------------+----------------------+---------------------+
```

## Функция TIME_TO_SEC() и SEC_TO_TIME()

Функция `TIME_TO_SEC()` используется для преобразования временного значения в секунды. Она принимает в качестве аргумента временное значение, преобразует его в количество секунд и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT TIME_TO_SEC('00:00:25'),
       TIME_TO_SEC('00:01:30'),
       TIME_TO_SEC('01:00:00');
```

является:

```sql
+-------------------------+-------------------------+-------------------------+
| TIME_TO_SEC('00:00:25') | TIME_TO_SEC('00:01:30') | TIME_TO_SEC('01:00:00') |
+-------------------------+-------------------------+-------------------------+
| 25                      | 90                      | 3600                    |
+-------------------------+-------------------------+-------------------------+
```

Похожим образом себя ведет функция SEC_TO_TIME() за тем исключением, что она выполняет обратное преобразование — количество секунд во временное значение.

Результатом приведенного ниже запроса:

```sql
SELECT SEC_TO_TIME(25),
       SEC_TO_TIME(90),
       SEC_TO_TIME(3600);
```

является:

```sql
+-----------------+-----------------+-------------------+
| SEC_TO_TIME(25) | SEC_TO_TIME(90) | SEC_TO_TIME(3600) |
+-----------------+-----------------+-------------------+
| 00:00:25        | 00:01:30        | 01:00:00          |
+-----------------+-----------------+-------------------+
```

## Функции TO_DAYS() и TO_SECONDS()

Функция `TO_DAYS()` используется для преобразования даты в количество дней. Она принимает в качестве аргумента дату, преобразует ее в количество дней и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT TO_DAYS('2023-04-01'),
       TO_DAYS('0001-01-01'),
       TO_DAYS('0000-01-01');
```

является:

```sql
+-----------------------+-----------------------+-----------------------+
| TO_DAYS('2023-04-01') | TO_DAYS('0001-01-01') | TO_DAYS('0000-01-01') |
+-----------------------+-----------------------+-----------------------+
| 738976                | 366                   | 1                     |
+-----------------------+-----------------------+-----------------------+
```

Обратите внимание, что отсчет количества дней начинается с нулевого года.

Похожим образом себя ведет функция `TO_SECONDS()`, за тем исключением, что она преобразует дату в количество секунд, а не дней.

Результатом приведенного ниже запроса:

```sql
SELECT TO_SECONDS('2023-04-01'),
       TO_SECONDS('0001-01-01'),
       TO_SECONDS('0000-01-01');
```

является:

```sql
+--------------------------+--------------------------+--------------------------+
| TO_SECONDS('2023-04-01') | TO_SECONDS('0001-01-01') | TO_SECONDS('0000-01-01') |
+--------------------------+--------------------------+--------------------------+
| 63847526400              | 31622400                 | 86400                    |
+--------------------------+--------------------------+--------------------------+
```

## Функция LAST_DAY()

Функция `LAST_DAY()` используется для замены дня на последний день месяца. Она принимает в качестве аргумента дату, заменяет в ней день на последний день месяца этой даты и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT LAST_DAY('2023-02-14'),
       LAST_DAY('2023-03-14'),
       LAST_DAY('2023-04-14');
```

является:

```sql
+------------------------+------------------------+------------------------+
| LAST_DAY('2023-02-14') | LAST_DAY('2023-03-14') | LAST_DAY('2023-04-14') |
+------------------------+------------------------+------------------------+
| 2023-02-28             | 2023-03-31             | 2023-04-30             |
+------------------------+------------------------+------------------------+
```
