# Нормальные формы

- [Нормальные формы](#нормальные-формы)
  - [Нормализация данных](#нормализация-данных)
  - [Нормальные формы](#нормальные-формы-1)
  - [Первая нормальная форма](#первая-нормальная-форма)
  - [Вторая нормальная форма](#вторая-нормальная-форма)
  - [Третья нормальная форма](#третья-нормальная-форма)

## Нормализация данных

**Нормализация** - это процесс организации данных в реляционной базе данных в соответствии с определенными правилами, которые устраняют избыточность и потенциальные ошибки.

**Избыточность** данных означает наличие повторяющейся или лишней информации в базе данных. Она приводит к непродуктивному расходыванию ресурсов хранилища и затрудняет обслуживание баз данных.

В приведенной таблице содержится избыточная информация:
![](https://i.ibb.co/2g3ZNcT/image.png)

Если предмет *Информатика* изменится на *Компьютерные науки*, то его нужно будет заменить во всех записях о студентах. Потенциальная ошибка тут - потеря информации и несогласованность. Мы можем забыть поменять у какого-то студента этот предмет.

> Ошибки, которые возникают при работе с ненормализованной БД, называют **аномалиями**. Существуют аномалии вставки, удаления и модификации.

## Нормальные формы

Существуют несколько наборов правил нормализации данных. Каждый такой набор называется **нормальной формой**.

Каждая следуюшая нормальная форма содержит более строгие правила и критерии. Приводя БД к определенной нормальной форме, мы устраняем определенный спектр проблем.

> Приведение БД к определенной НФ требует, чтобы БД находилась в предыдущей НФ.

Существует 5 основных нормальных форм: **первая**, **вторая**, **третья**, **четвертая** и **пятая**. Так же выделяют три дополнительные НФ: **шестая**, **НФ Бойса-Кодда**, **доменно-ключевая НФ**.

БД считается нормализованной, если она находится минимум в третьей НФ. Нормализация до третьей НФ является стандартной практикой, так как она устраняет достаточное количество аномалий.

## Первая нормальная форма

Первая НФ включает следующие правила:

1. в таблице не должно быть полей с одинаковым смыслом
2. в каждой ячейке таблицы должно находиться одиночное несоставное значение
3. таблица должна иметь первичный ключ

В качестве примера приведения к первой НФ рассмотрим следующую таблицу:

![](https://i.ibb.co/qgwPx3y/image.png)

Рассмотрим первое правило. Таблица содержит поля с одинаковым смыслом: *Первый предмет* и *Второй предмет*. В подобных таблицах сложно обеспечивать *согласованность* данных. Например, если появится студент, изучающий три или четыре предмета, придется целиком изменять структуру таблицы. Потенциальным решением проблемы может являться группировка схожих полей:

![](https://i.ibb.co/m4SSKcD/image.png)

Однако таблица по-прежнему не находится в первой нормальной форме, так как теперь некоторые ее ячейки содержат составные значения. Решением может быть дублирование записей таким образом, чтобы каждое составное значение стало одиночным:

![](https://i.ibb.co/7RLwHw5/image.png)

Теперь таблица находится в первой нормальной форме, так как она не имеет схожих по смыслу полей, в каждой ее ячейке находится одиночное значение, а первичным ключом в ней является сочетание полей *ID* и *Предмет*. Несмотря на это, она подвержена *аномалиям*. В частности, в данную таблицу нельзя внести информацию о студенте, не указав хотя бы один изучаемый предмет, а также невозможно удалить информацию обо всех изучаемых студентом предметах, не удалив информацию о нем самом.

## Вторая нормальная форма

Вторая нормальная форма является продолжением первой нормальной формы и включает следующие правила:

1. таблица должна находиться в первой нормальной форме
2. каждое неключевое поле таблицы должно зависеть только от полного первичного ключа, то есть от всех его полей

В качестве примера приведения ко второй нормальной форме рассмотрим предложенную ранее таблицу, которая уже находится в первой нормальной форме, однако для большей наглядности последующих рассуждений добавим в нее еще одно поле:

![](https://i.ibb.co/4pQXkyy/image.png)

Чтобы привести данную таблицу ко второй нормальной форме, необходимо разбить ее на несколько таблиц с учетом всех неполных зависимостей. В нашем случае неполную зависимость образуют поля *Имя* и *Фамилия*, поэтому их следует вынести в отдельную таблицу:

![](https://i.ibb.co/2cQXccz/image.png)

Тогда исходная таблица примет следующий вид:

![](https://i.ibb.co/LpfsYLQ/image.png)

Теперь мы имеем две таблицы, каждая из которых находится во второй нормальной форме. Также можно заметить, что после этого разбиения персональные данные студента и информация о его успеваемости стали независимыми. Это значит, что больше нет части аномалий, свойственных первой нормальной форме: вставка и удаление данных не затрагивают информацию, не связанную с ними напрямую.

> Процесс разбиения одной большой таблицы на несколько меньших таблиц называется **декомпозицией**.

## Третья нормальная форма

Третья нормальная форма исправляет оставшиеся после приведения ко второй нормальной форме аномалии и включает следующие правила:

1. таблица должна находиться во второй нормальной форме
2. каждое неключевое поле таблицы должно зависеть только от первичного ключа и ни от какого другого неключевого поля

Другими словами, третья нормальная форма говорит о том, что неключевые поля не должны вести себя как первичные ключи. Они не должны давать возможности получить данные из других полей, так как их задачей является лишь предоставление той информации, которая находится в них самих.

В качестве примера приведения к третьей нормальной форме рассмотрим следующую таблицу, которая уже находится во второй нормальной форме:

![](https://i.ibb.co/KKgvmD4/image.png)

Данная таблица содержит список сотрудников с указанием их должностей и размеров заработной платы. Первичным ключом в ней является поле ID. При этом известно, что размер заработной платы сотрудника полностью определяется занимаемой должностью. Следовательно, существует зависимость поля Зарплата от поля Должность, что делает таблицу не соответствующей требованиям третьей нормальной формы, и в ней есть аномалии модификации. Например, если Алан решит стать программистом, его зарплата все равно останется на прежнем уровне.

Таблица во второй нормальной форме приводится к третьей способом, похожим на то, как первая нормальная форма приводится ко второй — путем декомпозиции с учетом всех неудовлетворяющих зависимостей. В нашем случае неудовлетворяющую зависимость образует поле Зарплата, поэтому его следует вынести в отдельную таблицу:

![](https://i.ibb.co/hFgDcfN/image.png)

Тогда исходная таблица примет следующий вид:

![](https://i.ibb.co/Vw4VvpC/image.png)

Теперь мы имеем две таблицы, каждая из которых находится в третьей нормальной форме. Благодаря этому аномалия модификации больше не проявляется, и любой сотрудник после смены должности автоматически получит корректное изменение заработной платы.

Также следует заметить, что в таблице с информацией о должностях каждой должности был присвоен уникальный код, который используется в таблице с работниками для указания занимаемой должности. Теперь если мы решим переименовать должность Программист в Разработчик, это нужно будет сделать лишь единожды, а не изменять должность каждого работника, являющегося программистом.

> Приводить базу данных к третьей нормальной форме для устранения всех зависимостей не всегда практично. Значительное увеличение числа маленьких таблиц может привести к снижению производительности при работе с базой данных.
